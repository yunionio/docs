---
title: "裸金属网络"
date: 2021-08-03T10:53:20+08:00
weight: 20
description: >
  裸金属服务器的网络
---

目前，裸金属服务器只能使用经典网络。

## 经典网络

一台裸金属服务器有多个网卡，系统需要检测出这台裸金属的每个网口跟哪个二层网络对接，这样在分配裸金属服务器时，才能根据二层网络信息选择正确的IP子网。

系统通过两种方式探测裸金属的网卡对接的二层网络：

- 自动探测：在裸金属的prepare阶段，裸金属会自动设置每个网卡进行dhcp探测，当这个网卡所在网络的交换机配置了dhcp relay，则会把发出的dhcp请求转发到baremetal agent。baremetal Agent根据dhcp报文的来源IP找到匹配的IP子网，从而判断出该物理机网卡归属的二层子网。

- 手动设置：通过执行climc命令或者在前端界面，可以设置裸金属服务每个网卡对应的二层网络。

对应的climc命令为：

```bash
climc host-add-netif <host_id> <wire_id> <mac> <index>
```

### 裸金属网络配置对调度的影响

当用户申请一台裸金属服务，并给定裸金属服务器对接的IP子网信息时，调度器会过滤出物理网口对接了该IP子网对应的二层网络的裸金属，作为候选。

如果用户申请的裸金属服务器的网卡要做bonding，则调度器会选择同时具有两个网卡，并且两个网卡都对接了指定IP子网对应的二层网络。
