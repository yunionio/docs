---
title: "宿主机网络"
date: 2021-08-03T10:53:20+08:00
weight: 10
description: >
  KVM虚拟机所在宿主机的网络
---

## 经典网络

宿主机内通过host服务的配置项networks（/etc/yunion/host.conf）指定宿主机的网络配置，该配置指定宿主机的指定物理网卡对应的二层网络，有两种配置方式：

- 网卡名称/网桥名称/网卡IP，例如：eth0/br0/192.168.222.10。这种配置模式告诉系统，宿主机的物理网卡eth0对接了192.168.222.10这个IP对应的IP子网对应的二层网络，并且将该物理网卡和网桥br0桥接。这种模式的物理网卡要被宿主机用来和外界通信，因此要配置一个有效的IP地址。在host服务启动时，会检测该IP是否配置在这个物理网卡上，如果不匹配，host服务会放弃启动。以此避免误配置该网卡。启动成功后，host服务会自动创建网桥，把物理网卡计入该网桥，并且把物理网卡上的IP配置信息迁移到网桥，以维持宿主机的正常网络通信。

- 网卡名称/网桥名称/二层网络名称，例如：eth1/brpub/wire1。这种配置模式告诉系统，宿主机的物理网卡eth1对接了二层网络wire1，该网卡不需要配置有效IP地址，并且该物理网卡和网桥brpub桥接。这种模式的物理网卡不被宿主机用来通信，因此不需要显式地配置有效的IP地址。在host服务启动时，会检查该物理网卡是否没有IP，如果有IP，则会放弃启动。以此避免误操作。启动成功后，会自动创建网桥，把物理网卡加入该网桥，并且会自动分配一个169.254.0.0/16的IP给这个网桥。

### 宿主机网络配置对调度的影响

当创建一台经典网络的虚拟机，调度器会查看虚拟机准备对接的IP子网，根据IP子网的二层网络过滤出对接的宿主机，把这些宿主机作为候选宿主机。

## VPC网络

在host服务启动后，会在宿主机内创建用于vpc通信的网桥（默认名称为brvpc），所有对接VPC网络的虚拟机的虚拟网卡都要加入这个网桥。
