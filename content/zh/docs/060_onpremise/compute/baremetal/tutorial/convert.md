---
title: "物理机与宿主机互相转换"
weight: 5
description: >
---

## 界面操作

### 转换为宿主机

该功能用于将物理机设备转换成宿主机。物理机用于创建裸金属服务器，宿主机用于创建虚拟机。

#### 准备工作

1. 宿主机即安装了host服务的计算节点，在云管平台上将物理机转换为宿主机时需要使用由我司提供的专门制作的宿主机镜像。
2. 将该镜像上传到管理平台，并记录该镜像的id信息。
3. 在控制节点上通过climc命令设置物理机转换宿主机的默认镜像。

```bash
# 设置默认镜像的镜像id
$ climc service-config --config convert_hypervisor_default_template=a9b67435-8c08-4063-8ea6-d885ea26aa79 region2
```

4. 将物理机转换为宿主机时可直接选择磁盘RAID设置参数，进行转换宿主机操作。或通过自定义设置选择宿主机镜像，进行转换宿主机操作。

#### 操作步骤

1. 在物理机页面，单击物理机右侧操作列 **_"更多"_** 按钮，选择下拉菜单 **_"转换为宿主机"_** 菜单项，弹出转换为宿主机对话框
2. 配置以下参数：
    - 宿主机名称：宿主机名称默认为物理机名称，可修改。
    - 宿主机类型：目前仅支持KVM宿主机。
    - 磁盘RAID配置：包括默认配置(最高冗余)、RAID-1/RAID-10（两倍冗余）、RAID-5（1.x倍冗余）、RAID-0（无冗余）、自定义配置等。
{{% alert title="注意" color="warning" %}}
- 当物理机只存在一个RAID控制器，且该控制器下存在大于等于4块相同配置的磁盘时，物理机磁盘支持以上所有选项；
- 当磁盘RAID配置为不是“自定义配置”时，物理机转换成宿主机的镜像为控制节点上region.conf配置文件中设置的镜像，且不支持设置网卡绑定。
- 当物理机上存储不同大小的磁盘时，只支持自定义配置；
{{% /alert %}}
    - 当选择默认配置(最高冗余)、RAID-1/RAID-10（两倍冗余）、RAID-5（1.x倍冗余）、RAID-0（无冗余）时，需要配置网络信息，选择是否启用bonding。
       - 网络：设置宿主机的IP地址。当环境中有两张与网线连接的网卡需要做绑定设置时，可勾选"启用bonding"
{{% alert title="说明" %}}
  当物理机有两张连接网线的网卡时，将会自动绑定，当物理机有大于两张连接网线的网卡时，网卡绑定结果不可控，请谨慎操作。
{{% /alert %}}
          - 指定IP子网：选择IP子网，如需指定静态IP，可单击 **_"手动配置IP"_** 按钮，设置IP地址，单击 **_"确定"_** 按钮。
          - 指定调度标签：设置调度标签以及调度标签偏好。设置的调度标签偏好将会覆盖调度标签上的默认策略。根据调度标签及调度偏好选择最优的IP子网。
              - 尽量使用（prefer）：调度时优先使用拥有这种标签的IP子网。
              - 避免使用（avoid）：调度时尽量避免拥有这种标签的IP子网。
              - 禁止使用（exclude）：调度时排除拥有这种标签的IP子网。
              - 必须使用（require）：调度时必须使用拥有这种标签的IP子网。
    - 当选择自定义配置时，需要选择磁盘镜像、在自定义磁盘配置中新增磁盘，选择磁盘以及RIAD配置，设置网络信息，选择是否bonding。
      - 镜像：当选择自定义设置时，需要设置镜像为专用于宿主机的镜像。
      - 自定义硬盘配置：单击 **_"新增磁盘"_** 按钮，弹出新建磁盘配置对话框。
          - 选择物理机上的磁盘类型（HDD:3.6TIB表示物理机上一块磁盘大小为3.6TiB、磁盘类HDD）、设置RAID（包括不做RAID、RAID0、RAID1、RAID5、RAID10）
          - 设置磁盘数量，即使用几块相同配置的磁盘做RAID配置，如对磁盘做RAID0，磁盘利用率为100%；对2块磁盘做RAID1，磁盘利用率为50%；对3块及以上磁盘做RAID5，磁盘利用率为(n-1)/n；对4块及以上磁盘做RAID10，磁盘利用率为50%。
              - RAID0和不做RAID对磁盘数量无要求；
              - RAID1要求至少有2块相同的磁盘；
              - RAID5要求至少有3块相同的磁盘；
              - RAID10要求至少有4块相同的磁盘；
               
                ![](../../../images/computing/raid.png)
                ![](../../../images/computing/partition.png)
      
          - 单击 **_"确定"_** 按钮，显示磁盘分区名称和大小信息，支持在界面修改分区，可分别单击“系统分区”黄色区域修改分区设置、单击“待分区”区域设置分区。分区参数如下：
              - 挂载点：设置分区挂载点，存储池默认挂载点为“/opt/cloud/workspace”。
              - 分区格式：包括ext4、xfs、ntfs、swap分区。
              - 分区大小：包括最大容量和手动输入两种，最大容量使用磁盘所有空间，手动输入可以手动设置分区大小，单位为GB。
      
               ![](../../../images/computing/createpartition1\.png)
        
      - 网络：设置宿主机的IP地址。当环境中有两张与网线连接的网卡需要做绑定设置时，可勾选"启用bonding"
{{% alert title="说明" %}}
  当物理机有两张连接网线的网卡时，将会自动绑定，当物理机有大于两张连接网线的网卡时，网卡绑定结果不可控，请谨慎操作。
{{% /alert %}}
          - 指定IP子网：选择IP子网，如需指定静态IP，可单击 **_"手动配置IP"_** 按钮，设置IP地址，单击 **_"确定"_** 按钮。
          - 指定调度标签：设置调度标签以及调度标签偏好。设置的调度标签偏好将会覆盖调度标签上的默认策略。根据调度标签及调度偏好选择最优的IP子网。
              - 尽量使用（prefer）：调度时优先使用拥有这种标签的IP子网。
              - 避免使用（avoid）：调度时尽量避免拥有这种标签的IP子网。
              - 禁止使用（exclude）：调度时排除拥有这种标签的IP子网。
              - 必须使用（require）：调度时必须使用拥有这种标签的IP子网。

3. 单击 **_"确定"_** 按钮，将物理机转换为宿主机。



### 回收为物理机

该功能用于将宿主机回收成物理机。当宿主机类型为KVM且包含IPMI信息时可转为宿主机。物理机用于创建裸金属服务器，宿主机用于创建虚拟机。

**单个宿主机回收为物理机**

1. 单击宿主机右侧操作列 **_"更多"_** 按钮，选择下拉菜单 **_"回收为宿主机"_** 菜单项，弹出操作确认对话框。
2. 单击 **_"确定"_** 按钮，完成操作，可在物理机列表查看到服务器信息。

**批量将宿主机回收为物理机**

1. 在宿主机列表中勾选一个或多个宿主机，单击列表上方 **_"批量操作"_** 按钮，选择下拉菜单 **_"回收为宿主机"_** 菜单项，弹出操作确认对话框。
2. 单击 **_"确定"_** 按钮，完成操作，可在物理机列表查看到服务器信息。

## Climc

```bash
# 转换为宿主机
climc host-convert-hypervisor
# 回收为物理机
climc host-undo-convert <host_id>
```